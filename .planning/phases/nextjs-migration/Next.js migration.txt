Plan to implement                                                            │
│                                                                              │
│ Migration Plan Vanilla JS Frontend to Next.js                               │
│                                                                              │
│ Context                                                                      │
│                                                                              │
│ The contract redlining app currently uses a vanilla HTMLCSSJS frontend     │
│ (667-line HTML, 5,956-line CSS, 17 JS modules totaling ~6,500 lines) served  │
│ by Flask. David wants the UI to match the clean, minimalist Vercel aesthetic │
│  (pure white backgrounds, generous whitespace, thin borders, Geist font).    │
│ Rather than restyling the existing vanilla frontend, we're migrating to      │
│ Next.js + Tailwind + shadcnui, which gives us that aesthetic natively plus  │
│ proper component architecture and state management. The Flask backend stays  │
│ completely untouched.                                                        │
│                                                                              │
│ Architecture                                                                 │
│                                                                              │
│ Before  Flask serves staticindex.html + JSCSS (single origin, port 5000)  │
│ After   Next.js (port 3000) --proxy-- Flask API (port 5000)               │
│                                                                              │
│ - Next.js (App Router, TypeScript) serves the frontend                       │
│ - Flask stays as-is, serving api endpoints only                           │
│ - Next.js proxies api to Flask in development via next.config.js rewrites │
│ - flask-cors added as safety net                                             │
│                                                                              │
│ Tech Stack                                                                   │
│ Layer UI Framework                                                          │
│ Current Vanilla JS + DOM manipulation                                       │
│ Target React (Next.js App Router)                                           │
│ ────────────────────────────────────────                                     │
│ Layer Styling                                                               │
│ Current 5,956-line monolithic CSS                                           │
│ Target Tailwind CSS + shadcnui                                             │
│ ────────────────────────────────────────                                     │
│ Layer State                                                                 │
│ Current Global AppState object                                              │
│ Target Zustand store                                                        │
│ ────────────────────────────────────────                                     │
│ Layer Components                                                            │
│ Current None (17 JS modules)                                                │
│ Target shadcnui (Radix primitives)                                         │
│ ────────────────────────────────────────                                     │
│ Layer Fonts                                                                 │
│ Current Lora serif + Aptos sans                                             │
│ Target Geist Sans + Geist Mono                                              │
│ ────────────────────────────────────────                                     │
│ Layer Split panes                                                           │
│ Current Split.js (CDN)                                                      │
│ Target react-resizable-panels                                               │
│ ────────────────────────────────────────                                     │
│ Layer Toasts                                                                │
│ Current Custom DOM append                                                   │
│ Target sonner                                                               │
│ ────────────────────────────────────────                                     │
│ Layer Routing                                                               │
│ Current CSS class toggle                                                    │
│ Target Next.js file-based routing                                           │
│ ────────────────────────────────────────                                     │
│ Layer Types                                                                 │
│ Current None                                                                │
│ Target TypeScript interfaces                                                │
│ Design Language                                                              │
│ Property Background                                                         │
│ Current #fafaf9 warm gray                                                   │
│ Target #ffffff pure white                                                   │
│ ────────────────────────────────────────                                     │
│ Property Header                                                             │
│ Current Navy gradient #1e3a5f                                               │
│ Target White + 1px bottom border                                            │
│ ────────────────────────────────────────                                     │
│ Property Borders                                                            │
│ Current #e7e5e4 warm                                                        │
│ Target #e5e7eb cool neutral, 1px                                            │
│ ────────────────────────────────────────                                     │
│ Property Shadows                                                            │
│ Current Multiple levels                                                     │
│ Target Minimal, borders for separation                                      │
│ ────────────────────────────────────────                                     │
│ Property Font                                                               │
│ Current AptosLora                                                          │
│ Target Geist SansGeist Mono                                                │
│ ────────────────────────────────────────                                     │
│ Property Accents                                                            │
│ Current Multi-color (navy, red, orange)                                     │
│ Target Single blue #2563eb + severity colors                                │
│ ────────────────────────────────────────                                     │
│ Property Spacing                                                            │
│ Current Moderate                                                            │
│ Target Generous (16-24px padding)                                           │
│ ────────────────────────────────────────                                     │
│ Property Border radius                                                      │
│ Current 6-8px                                                               │
│ Target 8-12px cards, 6px buttons                                            │
│ Project Structure                                                            │
│                                                                              │
│ frontend                          # NEW - Next.js app                       │
│   src                                                                       │
│     app                                                                     │
│       layout.tsx                   # Root Geist font, global styles         │
│       page.tsx                     # DashboardIntake                        │
│       review[sessionId]page.tsx  # Review view (3-panel)                   │
│     components                                                              │
│       layout                     # Header, menus                            │
│       dashboard                  # Intake form, recent projects             │
│       review                     # Document viewer, sidebar, revision       │
│ sheet, nav panel                                                             │
│       dialogs                    # Flag, finalize, transmittal, new-project │
│       ui                         # shadcnui primitives (auto-generated)    │
│     hooks                        # use-session, use-document, use-analysis, │
│  use-revision, etc.                                                          │
│     lib                                                                     │
│       store.ts                    # Zustand (replaces AppState)              │
│       api.ts                      # Typed API client                         │
│       types.ts                    # TypeScript interfaces                    │
│       track-changes.ts            # Ported contenteditable logic from        │
│ revision.js                                                                  │
│     styles                                                                  │
│       document.css                # Preserved DOCX rendering styles          │
│       track-changes.css           # Red strikethrough + blue underline       │
│ app                               # UNCHANGED - Flask backend               │
│   server.py                       # Add flask-cors only                      │
│   apiroutes.py                   # No changes                               │
│   services                       # No changes                               │
│                                                                              │
│ Guiding Principles (from UI Refactoring Workflow)                            │
│                                                                              │
│ Adapted from httpsgithub.comapexscaleaiclaude-ui-design-systemblobmai │
│ nrefactoringui-refactoring-workflowSKILL.md                              │
│                                                                              │
│ 1. Refactoring != Feature Development During migration, NO new features.    │
│ Strict visualstructural parity with the existing app. New features come     │
│ after cutover.                                                               │
│ 2. Extract interfaces first Before building any components, define          │
│ TypeScript types from existing API response shapes (Phase 0). This is the    │
│ contract between frontend and backend.                                       │
│ 3. Design tokens before components Get the Tailwind config and CSS          │
│ variables right before writing any component code. Components should consume │
│  tokens, never hardcode values.                                              │
│ 4. Preserve functionality via interface extraction Each vanilla JS module's │
│  public API (what it exposes to other modules) becomes the React component's │
│  propshooks interface.                                                      │
│ 5. Accessibility as a migration goal Target WCAG 2.2 AA compliance. Add     │
│ proper aria- attributes, keyboard navigation, focus management, and screen  │
│ reader support as we rebuild each component.                                 │
│ 6. Validate at each phase boundary Before moving to the next phase, verify │
│  visual parity (screenshot compare), unchanged functionality (test the       │
│ workflow), no regressions in prior phases.                                   │
│                                                                              │
│ Phases                                                                       │
│                                                                              │
│ Phase 0 Scaffolding + Foundation                                            │
│                                                                              │
│ Set up Next.js project, install dependencies, configure API proxy, define    │
│ TypeScript types and design tokens.                                          │
│                                                                              │
│ - npx create-next-app@latest frontend --typescript --tailwind --eslint --app │
│  --src-dir                                                                   │
│ - npx shadcn@latest init in frontend                                        │
│ - Install zustand, react-resizable-panels, sonner, geist                    │
│ - Configure next.config.js rewrites to proxy api to Flask 5000           │
│ - Add Geist font in layout.tsx                                               │
│ - Set up Tailwind config with Vercel-aesthetic design tokens (Minimalist     │
│ Modern preset, tuned toward Vercel)                                          │
│ - Add flask-cors to Flask (pip install flask-cors, add CORS(app) in          │
│ server.py)                                                                   │
│ - Create libtypes.ts Define TypeScript interfaces for ALL API              │
│ requestresponse shapes by reading appapiroutes.py. This is done BEFORE    │
│ any component work.                                                          │
│ - Create libapi.ts Typed API client with functions for every endpoint      │
│ - Verify Next.js on 3000 can call Flask API on 5000, types compile        │
│ cleanly                                                                      │
│                                                                              │
│ Phase 1 Core Layout + Intake                                                │
│                                                                              │
│ Replace the dashboardintake screen. Header, menus, file upload, recent      │
│ projects.                                                                    │
│                                                                              │
│ - layout.tsx with clean white header (1px bottom border, Geist font)         │
│ - header.tsx with shadcn DropdownMenu for appuser menus                     │
│ - page.tsx (dashboard) with intake form + recent projects                    │
│ - intake-form.tsx with file upload drag-and-drop                             │
│ - recent-projects.tsx listing saved sessions                                 │
│ - Zustand store skeleton + typed API client                                  │
│ - shadcn components button, input, textarea, select, slider, dropdown-menu, │
│  separator, badge                                                            │
│ - Verify Upload a .docx, get session ID, see recent projects                │
│                                                                              │
│ Phase 2 Document Viewer + Navigation Panel                                  │
│                                                                              │
│ Render parsed document with clickable paragraphs, left nav panel with        │
│ outline.                                                                     │
│                                                                              │
│ - review[sessionId]page.tsx - 3-panel layout                               │
│ - document-viewer.tsx - fetch document{id}html, render via                │
│ dangerouslySetInnerHTML, attach click handlers via useEffect + ref           │
│ - paragraph.tsx - risk side-tabs, flag indicators, selection state           │
│ - navigation-panel.tsx - collapsible, document outline tree, review mode     │
│ selector (LinearBy RiskBy Category), search                                │
│ - sidebar.tsx - right panel skeleton with tabs                               │
│ - bottom-bar.tsx - bottom toolbar skeleton                                   │
│ - shadcn tabs, tooltip, skeleton                                            │
│ - Verify Navigate to review{sessionId}, see document, click paragraphs,   │
│ outline works                                                                │
│                                                                              │
│ Phase 3 Sidebar + Risk Analysis                                             │
│                                                                              │
│ Full sidebar with risk cards, analysis overlay with progress polling.        │
│                                                                              │
│ - risk-accordion.tsx + risk-card.tsx - severity badge, expandcollapse,      │
│ includeexclude toggle                                                       │
│ - related-clauses.tsx, definitions-tab.tsx, flags-tab.tsx                    │
│ - analysis-overlay.tsx - full-screen progress with legal verbs animation     │
│ - use-analysis.ts hook - poll analysis{id}progress, update store          │
│ incrementally                                                                │
│ - Risk hover highlighting via DOM ref into document container                │
│ - shadcn accordion, progress                                                │
│ - Verify Start review, see analysis progress, click paragraphs to see risks │
│  in sidebar                                                                  │
│                                                                              │
│ Phase 4 Revision Bottom Sheet + Track Changes Editor                        │
│                                                                              │
│ The most complex component - revision sheet with inline editing.             │
│                                                                              │
│ - bottom-sheet.tsx - draggable bottom panel (shadcn Sheet side=bottom)     │
│ - revision-sheet.tsx - diff display, rationale accordion,                    │
│ acceptrejectreopen buttons, RevisionDetails tabs                          │
│ - track-changes-editor.tsx - contenteditable wrapper using                   │
│ dangerouslySetInnerHTML + vanilla JS handlers                                │
│ - libtrack-changes.ts - port of revision.js contenteditable logic           │
│ (beforeinput interception, deletion wrapping, insertion spans, undoredo     │
│ stack) to TypeScript module                                                  │
│ - use-revision.ts hook - POST revise, accept, reject                      │
│ - Key approach editor is an uncontrolled component, keyed by paraId for     │
│ clean remount                                                                │
│ - Verify Generate revision, see diff, edit inline with track changes,       │
│ acceptreject works                                                          │
│                                                                              │
│ Phase 5 Precedent Split View                                                │
│                                                                              │
│ Side-by-side document comparison with resizable panes.                       │
│                                                                              │
│ - precedent-panel.tsx - precedent doc viewer with related clause             │
│ highlighting                                                                 │
│ - precedent-navigator.tsx - section navigator with search and confidence     │
│ dots                                                                         │
│ - Replace Split.js with react-resizable-panels (PanelGroup + Panel +         │
│ PanelResizeHandle)                                                           │
│ - use-precedent.ts hook - fetch precedent, related clauses, clause lock      │
│ state                                                                        │
│ - Verify Open precedent view, resize panes, related clauses highlight,      │
│ clause lock works                                                            │
│                                                                              │
│ Phase 6 Dialogs + Finalization                                              │
│                                                                              │
│ All modal dialogs and the finalization workflow.                             │
│                                                                              │
│ - flag-dialog.tsx - clientattorney tabs (shadcn Dialog)                     │
│ - finalize-dialog.tsx - revision preview + download buttons                  │
│ - transmittal-dialog.tsx - email preview + copy                              │
│ - new-project-dialog.tsx - savediscard confirmation (shadcn AlertDialog)    │
│ - use-flags.ts hook                                                          │
│ - Verify Flag clauses, finalize, download Word docs, generate transmittal   │
│                                                                              │
│ Phase 7 Polish + Validation                                                 │
│                                                                              │
│ Visual polish, edge cases, feature parity, accessibility audit.              │
│                                                                              │
│ - Keyboard shortcuts (Ctrl+B nav toggle)                                     │
│ - Lightdark mode toggle                                                     │
│ - Compact mode toggle                                                        │
│ - LocalStorage preferences                                                   │
│ - Bottom bar risk filters + prevnext navigation                             │
│ - Loadingerrorempty states                                                 │
│ - Responsive behavior                                                        │
│ - Accessibility audit Verify WCAG 2.2 AA - focus indicators, aria labels,   │
│ keyboard navigation through all interactive elements, screen reader testing  │
│ on document viewer + sidebar                                                 │
│ - Visual parity check Side-by-side comparison with old app - every feature  │
│ present, no regressions                                                      │
│ - Design token audit No hardcoded colorsspacingfonts anywhere - all via   │
│ Tailwind tokens                                                              │
│ - Final design audit all spacing, borders, colors match Vercel aesthetic    │
│                                                                              │
│ Phase 8 Cleanup + Cutover                                                   │
│                                                                              │
│ Remove old frontend, finalize architecture.                                  │
│                                                                              │
│ - Archive appstatic to _archived (keep for reference)                     │
│ - Remove Flask's send_from_directory route for index.html                    │
│ - Dev startup script (run both servers)                                      │
│ - Update README                                                              │
│                                                                              │
│ Key Technical Decisions                                                      │
│                                                                              │
│ Document HTML rendering Use dangerouslySetInnerHTML + useEffect for click   │
│ handlers. The backend generates high-fidelity HTML from .docx - trying to    │
│ parse this into React components would be fragile. The HTML is from our own  │
│ backend (no XSS risk).                                                       │
│                                                                              │
│ Track changes editor Isolate as uncontrolled React component. Port the      │
│ vanilla JS logic (1,040 lines from revision.js) to a TypeScript module that  │
│ attaches event handlers to a DOM ref. React manages surrounding UI; vanilla  │
│ JS manages the contenteditable internals. Key the component by paraId for    │
│ clean remount between paragraphs.                                            │
│                                                                              │
│ State management Zustand over ReduxContext. Lightweight, no boilerplate,   │
│ works well with the existing global-state-object mental model.               │
│                                                                              │
│ Routing  for dashboard, review[sessionId] for review. Makes sessions     │
│ bookmarkable. After intake, router.push(review${sessionId}).               │
│                                                                              │
│ Critical Files to Reference During Implementation                            │
│ File appstaticjsrevision.js (1,040 lines)                                │
│ Why Contenteditable track changes engine - must be ported to                │
│   libtrack-changes.ts                                                       │
│ ────────────────────────────────────────                                     │
│ File appstaticjssidebar.js (1,290 lines)                                 │
│ Why Risk accordion, clause viewer, related clauses - largest component      │
│ cluster                                                                      │
│ ────────────────────────────────────────                                     │
│ File appstaticjsprecedent.js (1,140 lines)                               │
│ Why Split view, clause lock, auto-jump logic                                │
│ ────────────────────────────────────────                                     │
│ File appapiroutes.py (1,441 lines)                                        │
│ Why Complete API contract - needed for typed API client                     │
│ ────────────────────────────────────────                                     │
│ File appstaticcssmain.css (5,956 lines)                                  │
│ Why Document rendering + track changes CSS to preserve                      │
│ ────────────────────────────────────────                                     │
│ File appstaticindex.html (667 lines)                                      │
│ Why HTML structure reference for component boundaries                       │
│ Verification                                                                 │
│                                                                              │
│ After each phase, verify by running both servers and testing the specific    │
│ feature set listed. After Phase 7, do a full parity check against the        │
│ original app by going through the complete workflow upload doc, run         │
│ analysis, review risks, generate revisions, edit inline, flag items,         │
│ finalize, download Word doc.                                                 │
╰───────────────────────────────────────────────────────