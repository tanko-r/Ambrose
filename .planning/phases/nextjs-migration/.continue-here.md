---
phase: nextjs-migration
task: Phase 2 - sidebar skeleton (task 4 of 7 in Phase 2)
total_phases: 8
status: in_progress
last_updated: 2026-02-07
---

<current_state>
Migrating vanilla JS frontend to Next.js + Tailwind + shadcn/ui. Phase 0 and Phase 1 are complete. Phase 2 is mid-flight — the sidebar.tsx file was just written to disk but the component has a TypeScript issue: the `RisksTabContent` component uses a complex conditional type for its `risks` prop that needs to be simplified to `Risk[]`. The sidebar, bottom-bar, review page layout, and final build verification are still needed.
</current_state>

<completed_work>
## Phase 0: Scaffolding + Foundation ✅
- Next.js 16 app scaffolded in `frontend/` (TypeScript, Tailwind v4, App Router)
- 16 shadcn/ui components installed (button, input, textarea, select, slider, dropdown-menu, separator, badge, tabs, tooltip, skeleton, accordion, progress, dialog, sheet, alert-dialog)
- Dependencies: zustand, react-resizable-panels, sonner, geist
- `next.config.ts` with API proxy rewrites (/api/* → Flask :5000) + turbopack.root
- `flask-cors` added to Flask `server.py` + `requirements.txt`
- Geist font configured in layout.tsx
- Design tokens in globals.css (pure white bg, blue #2563eb primary, severity colors, dark mode)
- `lib/types.ts` — 350+ lines of TypeScript interfaces for all API req/res shapes
- `lib/api.ts` — Typed API client for all 30+ endpoints
- `lib/store.ts` — Zustand store (session, document, analysis, review, UI state)
- Build verified: tsc + next build pass clean

## Phase 1: Core Layout + Intake ✅
- `components/layout/header.tsx` — White header, app/user dropdown menus, "New" button
- `components/dashboard/intake-form.tsx` — Drag-drop file upload, representation/approach/aggressiveness/context fields, submit to API
- `components/dashboard/recent-projects.tsx` — Fetches saved sessions, clickable resume items
- `components/dialogs/new-project-dialog.tsx` — Save/discard confirmation AlertDialog
- `app/page.tsx` — Dashboard with intake form card + recent projects sidebar
- Build verified: tsc + next build pass clean

## Phase 2: Document Viewer + Navigation Panel (IN PROGRESS)
- `hooks/use-document.ts` ✅ — Loads document data + HTML in parallel, updates store
- `components/review/document-viewer.tsx` ✅ — HTML rendering via dangerouslySetInnerHTML, click handlers on [data-para-id], smart scroll, selection/risk/revision/flag state classes, skeleton loading, plain-text fallback
- `components/review/navigation-panel.tsx` ✅ — Collapsible left panel, Linear/By Risk/By Category outline modes, search filter, progress counter, hierarchical indentation, severity indicators, reviewed checkmarks
- `components/review/sidebar.tsx` ⚠️ — Written but needs type fix in RisksTabContent prop (use `Risk[]` instead of conditional type). Has tabs (Risks/Related/Definitions/Flags), section ref header, severity badges, empty states, footer with generate button
</completed_work>

<remaining_work>
## Phase 2 remaining:
- Fix sidebar.tsx RisksTabContent prop type (change complex conditional type to `Risk[]`)
- `components/review/bottom-bar.tsx` — Fixed bottom toolbar with progress, risk filters (High/Med/Low), prev/next nav, finalize button (skeleton)
- `app/review/[sessionId]/page.tsx` — 3-panel layout composing nav panel + document viewer + sidebar + bottom bar, loading document on mount via useDocument hook
- Verify: tsc --noEmit passes, next build passes

## Phases 3-8 not started (see tasks/todo.md for full breakdown)
</remaining_work>

<decisions_made>
- Vercel aesthetic: pure white bg, blue #2563eb primary, cool neutral borders, Geist font (NOT the old navy gradient)
- Nav panel: white/light background instead of dark navy gradient from old app
- Document viewer: dangerouslySetInnerHTML for backend HTML + useEffect click handlers (not React components for doc content)
- Track changes editor will be uncontrolled component keyed by paraId (Phase 4)
- Zustand over Redux for state management
- API proxy via next.config.ts rewrites (primary), flask-cors as fallback
- shadcn/ui new-york style with neutral base color
- Tailwind CSS v4 (@import syntax, @theme inline block)
</decisions_made>

<blockers>
- None blocking. Minor type issue in sidebar.tsx is trivial to fix.
</blockers>

<context>
The migration follows a strict phase plan in tasks/todo.md. Each phase builds on the prior — Phase 0 (scaffold), Phase 1 (dashboard/intake), Phase 2 (review layout), Phase 3 (risk analysis), Phase 4 (revisions), Phase 5 (precedent), Phase 6 (dialogs), Phase 7 (polish), Phase 8 (cutover). The Flask backend is completely untouched except for adding flask-cors. The existing vanilla JS frontend in app/static/ remains functional.

Key reference files for future phases:
- `app/static/js/revision.js` (1,040 lines) — Port to lib/track-changes.ts in Phase 4
- `app/static/js/sidebar.js` (1,290 lines) — Full risk accordion in Phase 3
- `app/static/js/precedent.js` (1,140 lines) — Split view in Phase 5
- `app/static/css/main.css` (5,956 lines) — Document rendering CSS to preserve

Memory file at: C:\Users\david\.claude\projects\C--Users-david-Documents-claude-redlining\memory\MEMORY.md
</context>

<next_action>
1. Fix sidebar.tsx — change RisksTabContent prop type from conditional type to `Risk[]`
2. Create `components/review/bottom-bar.tsx` skeleton
3. Create `app/review/[sessionId]/page.tsx` — 3-panel layout wiring all components together
4. Run tsc --noEmit + next build to verify
5. Mark Phase 2 complete, update tasks/todo.md
</next_action>
