---
phase: nextjs-migration
task: Phase 3 - Sidebar + Risk Analysis (next up)
total_phases: 8
status: phase_2_complete
last_updated: 2026-02-07
---

<current_state>
Migrating vanilla JS frontend to Next.js + Tailwind + shadcn/ui. Phases 0, 1, and 2 are complete. All components compile and build cleanly. Ready for Phase 3: Sidebar + Risk Analysis.
</current_state>

<completed_work>
## Phase 0: Scaffolding + Foundation ✅
- Next.js 16 app scaffolded in `frontend/` (TypeScript, Tailwind v4, App Router)
- 16 shadcn/ui components installed
- Dependencies: zustand, react-resizable-panels, sonner, geist
- `next.config.ts` with API proxy rewrites (/api/* → Flask :5000) + turbopack.root
- `flask-cors` added to Flask `server.py` + `requirements.txt`
- Design tokens in globals.css (pure white bg, blue #2563eb primary, severity colors)
- `lib/types.ts` — 350+ lines of TypeScript interfaces for all API req/res shapes
- `lib/api.ts` — Typed API client for all 30+ endpoints
- `lib/store.ts` — Zustand store (session, document, analysis, review, UI state)

## Phase 1: Core Layout + Intake ✅
- `components/layout/header.tsx` — White header, app/user dropdown menus, "New" button
- `components/dashboard/intake-form.tsx` — Drag-drop file upload, all form fields
- `components/dashboard/recent-projects.tsx` — Fetches saved sessions
- `components/dialogs/new-project-dialog.tsx` — Save/discard confirmation
- `app/page.tsx` — Dashboard with intake form card + recent projects sidebar

## Phase 2: Document Viewer + Navigation Panel ✅
- `hooks/use-document.ts` — Loads document data + HTML in parallel, updates store
- `components/review/document-viewer.tsx` — HTML rendering via dangerouslySetInnerHTML, click handlers on [data-para-id], smart scroll, selection/risk/revision/flag state classes, skeleton loading, plain-text fallback
- `components/review/navigation-panel.tsx` — Collapsible left panel, Linear/By Risk/By Category outline modes, search filter, progress counter, hierarchical indentation, severity indicators
- `components/review/sidebar.tsx` — Tabs (Risks/Related/Definitions/Flags), section ref header, severity badges, risk cards, empty states, footer with generate button
- `components/review/bottom-bar.tsx` — Progress, severity summary pills, prev/next risk navigation, finalize button skeleton
- `app/review/[sessionId]/page.tsx` — 3-panel layout (nav + document + sidebar) + bottom bar + header
- Build verified: tsc --noEmit + next build pass clean
</completed_work>

<remaining_work>
## Phase 3: Sidebar + Risk Analysis
- risk-accordion.tsx + risk-card.tsx
- related-clauses.tsx, definitions-tab.tsx, flags-tab.tsx
- analysis-overlay.tsx — full-screen progress
- use-analysis.ts hook — poll progress, update store
- Risk hover highlighting

## Phases 4-8 (see tasks/todo.md for full breakdown)
</remaining_work>

<decisions_made>
- Vercel aesthetic: pure white bg, blue #2563eb primary, cool neutral borders, Geist font
- Document viewer: dangerouslySetInnerHTML for backend HTML + useEffect click handlers
- Track changes editor will be uncontrolled component keyed by paraId (Phase 4)
- Zustand over Redux for state management
- API proxy via next.config.ts rewrites (primary), flask-cors as fallback
- shadcn/ui new-york style with neutral base color
- Tailwind CSS v4 (@import syntax, @theme inline block)
</decisions_made>

<blockers>
- None
</blockers>

<context>
Key reference files for upcoming phases:
- `app/static/js/sidebar.js` (1,290 lines) — Full risk accordion for Phase 3
- `app/static/js/revision.js` (1,040 lines) — Port to lib/track-changes.ts in Phase 4
- `app/static/js/precedent.js` (1,140 lines) — Split view in Phase 5
- `app/static/css/main.css` (5,956 lines) — Document rendering CSS to preserve

Memory file at: C:\Users\david\.claude\projects\C--Users-david-Documents-claude-redlining\memory\MEMORY.md
</context>

<next_action>
1. Start Phase 3: Sidebar + Risk Analysis
2. Build risk-accordion.tsx and risk-card.tsx (enhance existing sidebar risk display)
3. Create analysis-overlay.tsx for full-screen progress during analysis
4. Create use-analysis.ts hook for polling analysis progress
5. Add risk hover highlighting in document viewer
</next_action>
