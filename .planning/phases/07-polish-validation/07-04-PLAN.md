---
phase: 07-polish-validation
plan: 04
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - frontend/src/components/small-screen-warning.tsx
  - frontend/src/app/layout.tsx
  - frontend/src/app/globals.css
  - frontend/src/components/review/sidebar.tsx
  - frontend/src/components/review/document-viewer.tsx
  - frontend/src/components/review/bottom-bar.tsx
  - frontend/src/components/layout/header.tsx
autonomous: true

must_haves:
  truths:
    - "Small screen warning overlay appears when viewport width is below 1280px"
    - "Warning does not completely block access -- user can still see the app behind the overlay"
    - "ARIA labels present on interactive elements (buttons, toggles, navigation)"
    - "Keyboard tab navigation works through document paragraphs and sidebar controls"
    - "Focus indicators visible on all interactive elements matching shadcn/ui defaults"
    - "Color contrast meets WCAG 2.1 AA on severity badges, muted text, and primary actions"
  artifacts:
    - path: "frontend/src/components/small-screen-warning.tsx"
      provides: "Viewport width guard with friendly message"
      min_lines: 20
  key_links:
    - from: "frontend/src/app/layout.tsx"
      to: "frontend/src/components/small-screen-warning.tsx"
      via: "SmallScreenWarning rendered in layout"
      pattern: "SmallScreenWarning"
---

<objective>
Add the small screen width warning overlay, perform an accessibility pass across all review components (ARIA labels, focus management, keyboard navigation, color contrast), and ensure visual parity with the design system.

Purpose: Small screen warning sets desktop-only expectations per locked decisions. Accessibility compliance is a Phase 7 success criterion (WCAG 2.1 AA). This plan closes the accessibility gap and ensures the app meets professional quality standards.
Output: Small screen warning component, accessibility-compliant review interface.
</objective>

<execution_context>
@C:/Users/david/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/david/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-polish-validation/07-RESEARCH.md
@frontend/src/app/layout.tsx
@frontend/src/components/layout/header.tsx
@frontend/src/components/review/sidebar.tsx
@frontend/src/components/review/bottom-bar.tsx
@frontend/src/components/review/document-viewer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Small screen warning and accessibility ARIA pass</name>
  <files>
    frontend/src/components/small-screen-warning.tsx
    frontend/src/app/layout.tsx
    frontend/src/components/layout/header.tsx
    frontend/src/components/review/sidebar.tsx
    frontend/src/components/review/bottom-bar.tsx
    frontend/src/components/review/document-viewer.tsx
    frontend/src/components/review/risk-card.tsx
    frontend/src/components/review/navigation-panel.tsx
    frontend/src/components/review/revision-sheet.tsx
  </files>
  <action>
    1. Create `frontend/src/components/small-screen-warning.tsx`:
       - "use client" component
       - Uses `useEffect` + `useState` to detect window.innerWidth < 1280
       - Listens to resize events
       - When small: renders a fixed overlay at z-[100] with semi-transparent background (bg-background/95 backdrop-blur-sm)
       - Content: centered card with title "Desktop Browser Required", message "This app requires a desktop browser with a minimum width of 1280px. Please resize your window or switch to a desktop device."
       - Does NOT block access completely -- uses pointer-events-none on overlay background but pointer-events-auto on the dismiss area (or simply a translucent overlay the user can see through)
       - Add a small "Dismiss" link/button that hides the warning for the current session (useState, not persisted)
       - Initial state on client: hidden (SSR safe -- window not available)

    2. Add SmallScreenWarning to layout.tsx:
       - Import and render `<SmallScreenWarning />` inside ThemeProvider, after children
       - Position: fixed overlay, so it doesn't affect layout

    3. ARIA accessibility pass on header.tsx:
       - Ensure header has `role="banner"` (or `<header>` which is semantic -- already correct)
       - Add `aria-label` to menu dropdown trigger: "Main menu"
       - Add `aria-label` to user dropdown trigger: "User menu"
       - Add `aria-label` to theme toggle: "Toggle color theme"
       - Add `aria-label` to New button: "Create new project"

    4. ARIA accessibility pass on sidebar.tsx:
       - Add `role="complementary"` and `aria-label="Analysis sidebar"` to sidebar container
       - Ensure tab list has `role="tablist"` (shadcn Tabs component should handle this, verify)
       - Each tab panel should have `role="tabpanel"` with `aria-labelledby` (shadcn handles this)
       - Add `aria-label` to any icon-only buttons (e.g., close button)

    5. ARIA accessibility pass on document-viewer.tsx:
       - Add `role="main"` and `aria-label="Document viewer"` to the document container
       - Ensure each clickable paragraph has `role="button"` and `tabindex="0"` for keyboard accessibility
       - Add `aria-selected="true"` to the selected paragraph
       - Add `aria-label` describing paragraph content (e.g., "Paragraph: Section 1.1" using section_ref)
       - Add `onKeyDown` handler to paragraphs: Enter/Space triggers click (same as mouse click)

    6. ARIA accessibility pass on bottom-bar.tsx:
       - Add `role="toolbar"` and `aria-label="Review toolbar"` to bottom bar container
       - Add `aria-label` to navigation buttons: "Previous risk", "Next risk"
       - Add `aria-label` to Finalize button, Transmittal button
       - Filter pills should have `aria-pressed` attribute reflecting toggle state

    7. ARIA accessibility pass on navigation-panel.tsx:
       - Add `role="navigation"` and `aria-label="Document navigator"` to panel container
       - Ensure navigation items are keyboard-focusable with proper aria-labels

    8. ARIA accessibility pass on risk-card.tsx:
       - Add `aria-label` to severity badge (e.g., "High severity risk")
       - Add `role="article"` to each risk card

    9. ARIA accessibility pass on revision-sheet.tsx:
       - Verify the Drawer component from vaul/shadcn has proper ARIA attributes
       - Add `aria-label` to action buttons (Accept, Reject, Edit)

    10. Focus indicator verification:
        - shadcn/ui components already have focus-visible styles via Tailwind's `focus-visible:ring-*`
        - Verify custom interactive elements (document paragraphs, filter pills, navigation items) have visible focus indicators
        - Add `focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2` to any custom clickable elements missing focus styles

    IMPORTANT per locked decisions:
    - Desktop-only, minimum 1280px width
    - Warning does not block access completely
    - WCAG 2.1 Level AA target
    - Focus indicators match shadcn/ui default styling
  </action>
  <verify>
    - `cd frontend && npm run build` completes without errors
    - small-screen-warning.tsx exists and renders overlay when width < 1280
    - Grep for `aria-label` across modified files returns multiple hits
    - Document paragraphs have role="button" and tabindex="0"
    - Bottom bar filter pills have aria-pressed attribute
  </verify>
  <done>
    Small screen warning overlay shows for viewports below 1280px. All interactive elements have ARIA labels. Document paragraphs are keyboard-accessible with role="button" and tabindex. Focus indicators match shadcn defaults. Color contrast reviewed for severity badges.
  </done>
</task>

<task type="auto">
  <name>Task 2: Install axe-core for dev, color contrast fixes, and final CSS polish</name>
  <files>
    frontend/src/app/globals.css
    frontend/src/app/layout.tsx
  </files>
  <action>
    1. Install @axe-core/react as dev dependency:
       ```
       cd frontend && npm install --save-dev @axe-core/react
       ```

    2. Add development-only axe-core initialization:
       - Create a small client component or add to an existing layout-level client component:
         ```typescript
         // Only in development mode
         if (typeof window !== 'undefined' && process.env.NODE_ENV === 'development') {
           import('@axe-core/react').then((axe) => {
             import('react-dom').then((ReactDOM) => {
               axe.default(React, ReactDOM, 1000)
             })
           })
         }
         ```
       - This outputs accessibility violations to Chrome DevTools console
       - No production overhead (tree-shaken out)

    3. Review and fix color contrast issues in globals.css:
       - **Severity badges**: Ensure severity-high (orange) on white/dark backgrounds has sufficient contrast (4.5:1 ratio for normal text, 3:1 for large text)
       - **Muted foreground**: Current `oklch(0.525 0 0)` on white bg -- verify 4.5:1 contrast ratio. If insufficient, darken slightly
       - **Dark mode muted foreground**: Current `oklch(0.708 0 0)` on dark bg -- verify contrast
       - **Info severity**: `oklch(0.525 0 0)` may be too low contrast -- adjust if needed
       - **Track changes red/blue in dark mode**: Verify the dark overrides from Plan 01 have sufficient contrast
       - Use oklch values that maintain WCAG AA contrast ratios (4.5:1 for text, 3:1 for large text/UI components)

    4. Ensure the document-container paragraphs have proper focus-visible styles:
       ```css
       .document-container [data-para-id]:focus-visible {
         outline: 2px solid var(--ring);
         outline-offset: 2px;
         border-radius: 4px;
       }
       ```

    5. Verify dark mode styles from Plan 01 render correctly in both themes:
       - Check that `.dark .document-container` overrides don't conflict with the base styles
       - Ensure the `.dark` prefix works correctly with the fixed `@custom-variant` from Plan 01

    6. Add print styles (minimal):
       ```css
       @media print {
         .no-print { display: none; }
       }
       ```
       Mark header, bottom bar, sidebar with `no-print` class if users want to print the document.

    IMPORTANT per locked decisions:
    - Validation method: Automated tools only (axe-core for dev, Lighthouse for final)
    - Fix all reported issues before phase completion
    - Focus indicators: Match shadcn/ui default styling
  </action>
  <verify>
    - `cd frontend && npm run build` completes without errors
    - @axe-core/react appears in devDependencies in package.json
    - globals.css has focus-visible styles for document paragraphs
    - Color contrast values meet WCAG AA (manual check: muted-foreground on background)
  </verify>
  <done>
    @axe-core/react installed for dev-time auditing, color contrast issues fixed for WCAG AA compliance, document paragraphs have focus-visible indicators, print styles added.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npm run build` passes
2. Resize browser below 1280px -- small screen warning appears
3. Dismiss warning -- app is accessible behind it
4. Tab through document -- focus indicators visible on each paragraph
5. Screen reader announces ARIA labels (verify with browser dev tools accessibility tree)
6. Run Lighthouse accessibility audit -- score above 90
7. Open Chrome DevTools console in dev mode -- axe-core outputs any remaining violations
</verification>

<success_criteria>
- Small screen warning overlay at < 1280px viewport
- All interactive elements have ARIA labels
- Document paragraphs keyboard-accessible (Tab, Enter, focus indicators)
- @axe-core/react running in development mode
- Color contrast meets WCAG 2.1 AA (4.5:1 text, 3:1 UI components)
- Focus indicators match shadcn/ui defaults
</success_criteria>

<output>
After completion, create `.planning/phases/07-polish-validation/07-04-SUMMARY.md`
</output>
